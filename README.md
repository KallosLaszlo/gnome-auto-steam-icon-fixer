# gnome-auto-steam-icon-fixer

## Overview
The `gnome-auto-steam-icon-fixer` is a Bash script designed to automate the process of fixing Steam desktop files. It specifically addresses the issue of missing `StartupWMClass` fields in `.desktop` files generated by Steam. This script utilizes `inotify-tools` to monitor the applications directory for any new or modified files and automatically patches them as needed.

## Features
- Installs `inotify-tools` if not already present.
- Monitors the Steam applications directory for changes.
- Automatically adds the `StartupWMClass` field to `.desktop` files that contain Steam icons.
- Option to enable GNOME notifications for patched files.
- Notifies the user of successful installation if notifications are enabled.
- Detects if the system is running Wayland and updates the window title dynamically for Steam games.

## Installation
1. Clone the repository:
   ```
   git clone https://github.com/KallosLaszlo/gnome-auto-steam-icon-fixer.git
   cd gnome-auto-steam-icon-fixer
   ```

2. Run the script:
   ```
   bash ./scripts/auto_steam_icon_fixer.sh
   ```

   During installation, you will be prompted to enable GNOME notifications for patched `.desktop` files. Press `Enter` to accept the default (`yes`) or type `n` to disable notifications.

## Files Created
The script creates the following files and directories:
- `~/.local/bin/fix_steam_desktops.sh`: The main script that monitors and patches `.desktop` files.
- `~/.config/systemd/user/fix-steam-desktops.path`: A systemd path unit file to monitor changes in the `~/.local/share/applications/` directory.
- `~/.config/systemd/user/fix-steam-desktops.service`: A systemd service unit file to execute the patching script when triggered by the path unit.

## Usage
Once the script is executed, it will set up a systemd service that monitors the `~/.local/share/applications/` directory. Whenever a new `.desktop` file is created or modified, the script will automatically check for the presence of a Steam icon and add the appropriate `StartupWMClass` field if it is missing.

If GNOME notifications are enabled, you will receive a notification each time a `.desktop` file is patched. Additionally, a notification will be displayed at the end of the installation process to confirm successful setup.

### Wayland-Specific Behavior
If the system is running Wayland (detected via the `XDG_SESSION_TYPE` environment variable), the script will attempt to dynamically update the window title for Steam games. The window title, which defaults to `steam_app_<Steam ID>`, will be updated to match the `.desktop` file name. This ensures that the correct game name is displayed in `alt+tab` and other window switchers.

## Advanced Users
For advanced users who want to understand or customize the setup:
1. The script installs `inotify-tools` if not already present. You can skip this step if you already have it installed.
2. The main patching script is located at `~/.local/bin/fix_steam_desktops.sh`. You can edit this file to modify the behavior of the patching process.
3. The systemd path unit (`~/.config/systemd/user/fix-steam-desktops.path`) monitors the `~/.local/share/applications/` directory for changes. You can adjust the `PathModified` or `PathChanged` fields if needed.
4. The systemd service unit (`~/.config/systemd/user/fix-steam-desktops.service`) executes the patching script. You can modify the `ExecStart` field to point to a different script or add additional options.
5. To manually reload and restart the systemd configurations:
   ```
   systemctl --user daemon-reload
   systemctl --user enable --now fix-steam-desktops.path
   systemctl --user restart fix-steam-desktops.path
   ```

## License
This project is licensed under the MIT License. See the `LICENSE` file for more details.

## Contributing
Contributions are welcome! Please feel free to submit a pull request or open an issue for any enhancements or bug fixes.

## Acknowledgments
- Thanks to the developers of `inotify-tools` for providing the necessary tools to monitor file changes.